# Tsugi no Tokimeki - é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

> æ¬¡ã®ãƒˆã‚­ãƒ¡ã‚­ã‚’é€ƒã•ãªã„ãŸã‚ã®è¡Œå‹•åˆ¤æ–­ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

## ğŸ“Š å®Ÿè£…çŠ¶æ³

### Phase 1: MVP / ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆç¾åœ¨ï¼‰

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------------|------|------|
| Next.js (App Router) | âœ… å®Œäº† | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åŸºç›¤ |
| Firebase Auth (åŒ¿å) | âœ… å®Œäº† | åŒ¿åãƒ­ã‚°ã‚¤ãƒ³ |
| Firestore (posts/users) | âœ… å®Œäº† | åŸºæœ¬ãƒ‡ãƒ¼ã‚¿æ§‹é€  |
| ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚° UI | âœ… å®Œäº† | æ¨ã—ã‚­ãƒ£ãƒ©ãƒ»ã‚¨ãƒªã‚¢ãƒ»ç©ºãæ™‚é–“è¨­å®š |
| æŠ•ç¨¿æ©Ÿèƒ½ | âœ… å®Œäº† | ç›®æ’ƒæƒ…å ±ã®æŠ•ç¨¿ãƒ»é–²è¦§ |
| ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º | âœ… å®Œäº† | è¡Œã‘ã‚‹å€™è£œæ—¥ã®è¡¨ç¤º |
| è¡Œå‹•åˆ¤æ–­ãƒ­ã‚¸ãƒƒã‚¯ | âš ï¸ ãƒ¢ãƒƒã‚¯ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |

### Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¼·åŒ–

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------------|------|------|
| Next.js Route Handlers | âœ… å®Œäº† | /api/analyze ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
| Vertex AI (Gemini) é€£æº | âœ… å®Œäº† | gemini-2.5-flash ä½¿ç”¨ |
| suggestions ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ | âœ… å®Œäº† | users/{uid}/suggestions/latest |
| è»¢å£²å¯¾ç­– (posts_private) | âŒ æœªå®Ÿè£… | ä½æ‰€æƒ…å ±ã®åˆ†é›¢ç®¡ç† |

### Phase 3: v3 å®Œå…¨ç‰ˆï¼ˆTODOï¼‰

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------------|------|------|
| Cloud Run ãƒ‡ãƒ—ãƒ­ã‚¤ | âœ… å®Œäº† | æœ¬ç•ªç’°å¢ƒï¼ˆCloud Buildé€£æºæ¸ˆã¿ï¼‰ |
| Cloud Scheduler | âŒ æœªå®Ÿè£… | å®šæœŸå®Ÿè¡Œï¼ˆæ¯æœ/æ¯æ™‚ï¼‰ |
| Event Matcher | âŒ æœªå®Ÿè£… | ç©ºãæ™‚é–“ Ã— ã‚¤ãƒ™ãƒ³ãƒˆçªåˆ |
| user_event_matches | âŒ æœªå®Ÿè£… | ãƒãƒƒãƒãƒ³ã‚°çµæœä¿å­˜ |
| ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ | âŒ æœªå®Ÿè£… | FCM or LINEé€£æº |

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆv3 ç›®æ¨™ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Client (Browser/PWA)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Next.js UI     â”‚  â”‚  Firebase Auth SDK              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                            â”‚
            â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Google Cloud / Firebase                       â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Server (Cloud Run)                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Next.js Route       â”‚  â”‚ v3 Core Logic              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Handlers (API)      â”‚  â”‚ - è¡Œå‹•åˆ¤æ–­ãƒ­ã‚¸ãƒƒã‚¯         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - Event Matcher            â”‚ â”‚ â”‚
â”‚  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Firestore      â”‚  â”‚  Vertex AI      â”‚  â”‚ Cloud         â”‚ â”‚
â”‚  â”‚  - users        â”‚  â”‚  (Gemini)       â”‚  â”‚ Scheduler     â”‚ â”‚
â”‚  â”‚  - posts        â”‚  â”‚                 â”‚  â”‚               â”‚ â”‚
â”‚  â”‚  - store_events â”‚  â”‚                 â”‚  â”‚               â”‚ â”‚
â”‚  â”‚  - suggestions  â”‚  â”‚                 â”‚  â”‚               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Firestore ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ

### ç¾åœ¨å®Ÿè£…æ¸ˆã¿

```
artifacts/{appId}/
  â”œâ”€â”€ users/{uid}/
  â”‚   â””â”€â”€ profile/main     # ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šï¼ˆfavorites, area, availabilityï¼‰
  â””â”€â”€ public/data/
      â”œâ”€â”€ posts/           # æŠ•ç¨¿ï¼ˆç›®æ’ƒæƒ…å ±ï¼‰
      â””â”€â”€ store_events/    # åº—èˆ—ã‚¤ãƒ™ãƒ³ãƒˆ
```

### v3 ã§è¿½åŠ äºˆå®š

```
artifacts/{appId}/
  â”œâ”€â”€ users/{uid}/
  â”‚   â”œâ”€â”€ profile/main
  â”‚   â””â”€â”€ event_matches/   # è¡Œã‘ã‚‹å€™è£œæ—¥ï¼ˆNEWï¼‰
  â””â”€â”€ public/data/
      â”œâ”€â”€ posts/
      â”œâ”€â”€ posts_private/   # è©³ç´°ä½æ‰€ï¼ˆè»¢å£²å¯¾ç­–ï¼‰ï¼ˆNEWï¼‰
      â”œâ”€â”€ store_events/
      â””â”€â”€ suggestions/     # AIç”Ÿæˆã®è¡Œå‹•ææ¡ˆï¼ˆNEWï¼‰
```

---

## ğŸ”§ é–‹ç™ºç’°å¢ƒ

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# ãƒ“ãƒ«ãƒ‰
npm run build

# æœ¬ç•ªèµ·å‹•
npm start
```

### ç’°å¢ƒå¤‰æ•°ï¼ˆ.env.localï¼‰

```
NEXT_PUBLIC_FIREBASE_API_KEY=xxx
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=xxx
NEXT_PUBLIC_FIREBASE_PROJECT_ID=xxx
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=xxx
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=xxx
NEXT_PUBLIC_FIREBASE_APP_ID=xxx
```

---

## ğŸ“… ä»Šå¾Œã® TODO

### çŸ­æœŸï¼ˆå®Œäº†ï¼‰
- [x] ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œç¢ºèª
- [x] Firebase Emulatorå¯¾å¿œ
- [x] Cloud Run ãƒ‡ãƒ—ãƒ­ã‚¤

### ä¸­æœŸï¼ˆé€²è¡Œä¸­ï¼‰
- [x] Route Handlers ã§APIä½œæˆï¼ˆ/api/analyzeï¼‰
- [x] Vertex AI é€£æº
- [ ] Cloud Scheduler è¨­å®šï¼ˆå®šæœŸå®Ÿè¡Œï¼‰
- [ ] è»¢å£²å¯¾ç­–ã®å®Ÿè£…

### é•·æœŸï¼ˆv3å®Œå…¨ç‰ˆï¼‰
- [ ] Event Matcher å®Ÿè£…
- [ ] ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ï¼ˆLINEé€£æºï¼‰
- [ ] Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æº

---

*Last Updated: 2026-01-31*



